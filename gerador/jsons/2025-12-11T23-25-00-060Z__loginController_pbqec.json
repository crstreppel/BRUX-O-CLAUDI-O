{
  "caminho": "../backend/modules/usuarios",
  "arquivo": "loginController.js",
  "conteudo": "const jwt = require('jsonwebtoken');\nconst bcrypt = require('bcryptjs');\nconst { Usuario, Role, Permissao } = require('../config/sequelize');\n\nmodule.exports = {\n  async login(req, res) {\n    try {\n      const { email, senha } = req.body;\n\n      if (!email || !senha) {\n        return res.status(400).json({ erro: 'Email e senha são obrigatórios.' });\n      }\n\n      const usuario = await Usuario.findOne({\n        where: { email },\n        include: [\n          {\n            model: Role,\n            as: 'role',\n            include: [\n              {\n                model: Permissao,\n                as: 'permissoes'\n              }\n            ]\n          }\n        ]\n      });\n\n      if (!usuario) {\n        return res.status(404).json({ erro: 'Usuário não encontrado.' });\n      }\n\n      const senhaCorreta = await bcrypt.compare(senha, usuario.senha);\n      if (!senhaCorreta) {\n        return res.status(401).json({ erro: 'Senha inválida.' });\n      }\n\n      const permissoes = usuario.role?.permissoes?.map(p => p.chave) || [];\n\n      const token = jwt.sign(\n        {\n          id: usuario.id,\n          roleId: usuario.role?.id || null,\n          permissoes\n        },\n        'SEGREDO_SUPER_PBQE',\n        { expiresIn: '8h' }\n      );\n\n      return res.json({\n        id: usuario.id,\n        nome: usuario.nome,\n        email: usuario.email,\n        role: usuario.role?.nome || null,\n        permissoes,\n        token\n      });\n    } catch (err) {\n      return res.status(500).json({ erro: err.message });\n    }\n  }\n};"
}