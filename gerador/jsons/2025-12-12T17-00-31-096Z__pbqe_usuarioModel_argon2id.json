{
  "caminho": "../backend/modules/usuarios",
  "arquivo": "usuarioModel.js",
  "conteudo": "// ======================================================================\n// ðŸ§™â€â™‚ï¸ usuarioModel.js â€¢ PBQE-C V2 â€“ MÃ³dulo UsuÃ¡rios (ARGON2id)\n// ----------------------------------------------------------------------\nconst { DataTypes } = require('sequelize');\nconst sequelize = require('../../config/connection');\nconst argon2 = require('argon2');\n\nconst Usuario = sequelize.define(\n  'Usuario',\n  {\n    id: {\n      type: DataTypes.UUID,\n      defaultValue: DataTypes.UUIDV4,\n      primaryKey: true,\n    },\n\n    usuario: {\n      type: DataTypes.STRING(50),\n      allowNull: false,\n      unique: true,\n    },\n\n    email: {\n      type: DataTypes.STRING(120),\n      allowNull: false,\n      unique: true,\n    },\n\n    senhaHash: {\n      type: DataTypes.STRING(255),\n      allowNull: false,\n      field: 'senha_hash',\n    },\n\n    emailVerificado: {\n      type: DataTypes.BOOLEAN,\n      allowNull: false,\n      defaultValue: false,\n      field: 'email_verificado',\n    },\n\n    emailToken: {\n      type: DataTypes.STRING(255),\n      allowNull: true,\n      field: 'email_token',\n    },\n\n    emailTokenExpiraEn: {\n      type: DataTypes.DATE,\n      allowNull: true,\n      field: 'email_token_expira_en',\n    },\n\n    emailCodigo: {\n      type: DataTypes.STRING(10),\n      allowNull: true,\n      field: 'email_codigo',\n    },\n\n    emailCodigoTentativas: {\n      type: DataTypes.INTEGER,\n      allowNull: false,\n      defaultValue: 0,\n      field: 'email_codigo_tentativas',\n    },\n\n    statusId: {\n      type: DataTypes.UUID,\n      allowNull: true,\n      field: 'status_id',\n    },\n\n    ativo: {\n      type: DataTypes.BOOLEAN,\n      allowNull: false,\n      defaultValue: true,\n    },\n\n    deletedAt: {\n      type: DataTypes.DATE,\n      allowNull: true,\n      field: 'deleted_at',\n    },\n  },\n  {\n    tableName: 'usuarios',\n    paranoid: true,\n    timestamps: true,\n    underscored: true,\n  }\n);\n\n// ======================================================================\n// ðŸ” Hooks PBQE-C â€“ Hash automÃ¡tico da senha (Argon2id)\n// ----------------------------------------------------------------------\nUsuario.beforeCreate(async (usuario) => {\n  if (usuario.senhaHash) {\n    usuario.senhaHash = await argon2.hash(usuario.senhaHash, {\n      type: argon2.argon2id,\n    });\n  }\n});\n\nUsuario.beforeUpdate(async (usuario) => {\n  if (usuario.changed('senhaHash')) {\n    usuario.senhaHash = await argon2.hash(usuario.senhaHash, {\n      type: argon2.argon2id,\n    });\n  }\n});\n\n// ======================================================================\n// ðŸ”Ž MÃ©todo de instÃ¢ncia â€“ ValidaÃ§Ã£o de senha\n// ----------------------------------------------------------------------\nUsuario.prototype.validarSenha = async function (senhaPlain) {\n  return argon2.verify(this.senhaHash, senhaPlain);\n};\n\nmodule.exports = Usuario;\n"
}