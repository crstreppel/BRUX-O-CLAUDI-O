[
  {
    "caminho": "../backend/public/modules/usuarios",
    "arquivo": "usuarios.js",
    "conteudo": "// ======================================================================\n// ðŸ§™â€â™‚ï¸ usuarios.js â€¢ PBQE-C V2 Clean Light â€“ Fluxo de AutenticaÃ§Ã£o\n// ----------------------------------------------------------------------\nconst API_BASE = '/api/usuarios';\n\nfunction setMessage(elementId, message, type = 'info') {\n  const el = document.getElementById(elementId);\n  if (!el) return;\n  el.textContent = message || '';\n  el.className = 'auth-message ' + (message ? `is-${type}` : '');\n}\n\nasync function postJSON(url, payload) {\n  const response = await fetch(url, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(payload)\n  });\n  const data = await response.json().catch(() => ({}));\n  return { ok: response.ok, status: response.status, data };\n}\n\n// ------------------------- Cadastro -----------------------------------\nasync function handleCadastro(event) {\n  event.preventDefault();\n  const usuario = document.getElementById('usuario').value.trim();\n  const email = document.getElementById('email').value.trim();\n  const senha = document.getElementById('senha').value;\n  const senha2 = document.getElementById('senha2').value;\n\n  if (!usuario || !email || !senha || !senha2) {\n    setMessage('msgCadastro', 'Preencha todos os campos.', 'error');\n    return;\n  }\n  if (senha !== senha2) {\n    setMessage('msgCadastro', 'As senhas nÃ£o conferem.', 'error');\n    return;\n  }\n\n  setMessage('msgCadastro', 'Cadastrando usuÃ¡rio...', 'info');\n\n  try {\n    const { ok, data, status } = await postJSON(`${API_BASE}/cadastrar`, {\n      usuario,\n      email,\n      senha\n    });\n\n    if (!ok) {\n      setMessage('msgCadastro', data.erro || `Erro no cadastro (HTTP ${status}).`, 'error');\n      return;\n    }\n\n    setMessage('msgCadastro', 'UsuÃ¡rio criado! Verifique o e-mail para confirmar o acesso.', 'success');\n  } catch (error) {\n    console.error('Erro no cadastro:', error);\n    setMessage('msgCadastro', 'Erro interno ao cadastrar usuÃ¡rio.', 'error');\n  }\n}\n\n// ------------------------- Login --------------------------------------\nasync function handleLogin(event) {\n  event.preventDefault();\n  const usuario = document.getElementById('loginUsuario').value.trim();\n  const senha = document.getElementById('loginSenha').value;\n\n  if (!usuario || !senha) {\n    setMessage('msgLogin', 'Informe usuÃ¡rio e senha.', 'error');\n    return;\n  }\n\n  setMessage('msgLogin', 'Validando credenciais...', 'info');\n\n  try {\n    const { ok, data, status } = await postJSON(`${API_BASE}/login`, {\n      usuario,\n      senha\n    });\n\n    if (!ok) {\n      if (status === 401 && data.motivo === 'EMAIL_NAO_VERIFICADO') {\n        setMessage('msgLogin', 'E-mail ainda nÃ£o confirmado. Use a opÃ§Ã£o de confirmaÃ§Ã£o.', 'warn');\n        return;\n      }\n      setMessage('msgLogin', data.erro || `Falha no login (HTTP ${status}).`, 'error');\n      return;\n    }\n\n    window.location.href = 'fogo.html';\n  } catch (error) {\n    console.error('Erro no login:', error);\n    setMessage('msgLogin', 'Erro interno ao fazer login.', 'error');\n  }\n}\n\n// ------------------------- ConfirmaÃ§Ã£o por cÃ³digo ---------------------\nasync function handleConfirmacaoCodigo(event) {\n  event.preventDefault();\n  const email = document.getElementById('confEmail').value.trim();\n  const codigo = document.getElementById('confCodigo').value.trim();\n\n  if (!email || !codigo) {\n    setMessage('msgConfirmacao', 'Informe e-mail e cÃ³digo.', 'error');\n    return;\n  }\n\n  setMessage('msgConfirmacao', 'Validando cÃ³digo...', 'info');\n\n  try {\n    const { ok, data, status } = await postJSON(`${API_BASE}/confirmar-codigo`, {\n      email,\n      codigo\n    });\n\n    if (!ok) {\n      setMessage('msgConfirmacao', data.erro || `Erro ao confirmar (HTTP ${status}).`, 'error');\n      return;\n    }\n\n    setMessage('msgConfirmacao', 'E-mail confirmado com sucesso! Agora vocÃª pode fazer login.', 'success');\n  } catch (error) {\n    console.error('Erro na confirmaÃ§Ã£o:', error);\n    setMessage('msgConfirmacao', 'Erro interno ao confirmar e-mail.', 'error');\n  }\n}\n\n// ------------------------- Reenvio de confirmaÃ§Ã£o ---------------------\nasync function handleReenvio() {\n  const emailInput = document.getElementById('confEmail');\n  if (!emailInput) return;\n  const email = emailInput.value.trim();\n\n  if (!email) {\n    setMessage('msgConfirmacao', 'Informe o e-mail para reenviar o cÃ³digo.', 'error');\n    return;\n  }\n\n  setMessage('msgConfirmacao', 'Reenviando cÃ³digo...', 'info');\n\n  try {\n    const { ok, data, status } = await postJSON(`${API_BASE}/reenviar-confirmacao`, { email });\n\n    if (!ok) {\n      setMessage('msgConfirmacao', data.erro || `Erro ao reenviar (HTTP ${status}).`, 'error');\n      return;\n    }\n\n    setMessage('msgConfirmacao', 'CÃ³digo reenviado para o e-mail informado.', 'success');\n  } catch (error) {\n    console.error('Erro no reenvio:', error);\n    setMessage('msgConfirmacao', 'Erro interno ao reenviar cÃ³digo.', 'error');\n  }\n}\n\n// ------------------------- NavegaÃ§Ã£o / UI ------------------------------\nfunction setupNavigation() {\n  const btnIrConfirmar = document.getElementById('btnIrConfirmar');\n  const btnIrCadastro = document.getElementById('btnIrCadastro');\n  const btnAbrirConfirmacao = document.getElementById('btnAbrirConfirmacao');\n  const secConfirmacao = document.getElementById('secConfirmacao');\n\n  if (btnIrConfirmar) {\n    btnIrConfirmar.addEventListener('click', () => {\n      window.location.href = 'usuarios.html';\n    });\n  }\n\n  if (btnIrCadastro) {\n    btnIrCadastro.addEventListener('click', () => {\n      window.location.href = 'cadastro.html';\n    });\n  }\n\n  if (btnAbrirConfirmacao && secConfirmacao) {\n    btnAbrirConfirmacao.addEventListener('click', () => {\n      secConfirmacao.hidden = !secConfirmacao.hidden;\n    });\n  }\n}\n\n// ------------------------- InicializaÃ§Ã£o -------------------------------\ndocument.addEventListener('DOMContentLoaded', () => {\n  const formCadastro = document.getElementById('formCadastro');\n  if (formCadastro) {\n    formCadastro.addEventListener('submit', handleCadastro);\n  }\n\n  const formLogin = document.getElementById('formLogin');\n  if (formLogin) {\n    formLogin.addEventListener('submit', handleLogin);\n  }\n\n  const formConfirmarCodigo = document.getElementById('formConfirmarCodigo');\n  if (formConfirmarCodigo) {\n    formConfirmarCodigo.addEventListener('submit', handleConfirmacaoCodigo);\n  }\n\n  const btnReenviar = document.getElementById('btnReenviar');\n  if (btnReenviar) {\n    btnReenviar.addEventListener('click', handleReenvio);\n  }\n\n  setupNavigation();\n});\n"
  }
]