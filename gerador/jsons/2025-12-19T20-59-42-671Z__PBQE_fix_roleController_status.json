{
  "caminho": "../backend/modules/roles",
  "arquivo": "roleController.js",
  "conteudo": "// ======================================================================\n// üßô‚Äç‚ôÇÔ∏è roleController.js ‚Ä¢ PBQE-C ‚Äì Ajuste de status autom√°tico no criar\n// ----------------------------------------------------------------------\nconst Role = require('./roleModel');\nconst Status = require('../status/statusModel');\n\nmodule.exports = {\n  async criar(req, res) {\n    try {\n      const { nome, descricao } = req.body;\n\n      if (!nome || !descricao) {\n        return res.status(400).json({ erro: 'Campos obrigat√≥rios ausentes.' });\n      }\n\n      const existente = await Role.findOne({ where: { nome } });\n      if (existente) {\n        return res.status(400).json({ erro: 'J√° existe um role com esse nome.' });\n      }\n\n      // üîê Status padr√£o definido pelo backend\n      const statusAtivo = await Status.findOne({ where: { nome: 'ATIVO' } });\n      if (!statusAtivo) {\n        return res.status(500).json({ erro: 'Status ATIVO n√£o encontrado.' });\n      }\n\n      const novo = await Role.create({\n        nome,\n        descricao,\n        statusId: statusAtivo.id,\n        ativo: true\n      });\n\n      return res.status(201).json(novo);\n    } catch (err) {\n      return res.status(500).json({ erro: err.message });\n    }\n  },\n\n  async listar(req, res) {\n    try {\n      const dados = await Role.findAll({\n        include: [\n          {\n            model: Status,\n            as: 'status'\n          }\n        ]\n      });\n      return res.json(dados);\n    } catch (err) {\n      return res.status(500).json({ erro: err.message });\n    }\n  },\n\n  async atualizar(req, res) {\n    try {\n      const { id } = req.params;\n      const { nome, descricao, ativo, statusId } = req.body;\n\n      const registro = await Role.findByPk(id);\n      if (!registro) {\n        return res.status(404).json({ erro: 'Registro n√£o encontrado.' });\n      }\n\n      const camposAtualizar = {};\n\n      if (nome !== undefined) camposAtualizar.nome = nome;\n      if (descricao !== undefined) camposAtualizar.descricao = descricao;\n      if (ativo !== undefined) camposAtualizar.ativo = ativo;\n      if (statusId !== undefined) camposAtualizar.statusId = statusId;\n\n      await registro.update(camposAtualizar);\n\n      return res.json({ mensagem: 'Atualizado com sucesso.' });\n    } catch (err) {\n      return res.status(500).json({ erro: err.message });\n    }\n  },\n\n  async excluir(req, res) {\n    try {\n      const { id } = req.params;\n\n      const registro = await Role.findByPk(id);\n      if (!registro) {\n        return res.status(404).json({ erro: 'Registro n√£o encontrado.' });\n      }\n\n      await registro.update({\n        ativo: false,\n        deletedAt: new Date()\n      });\n\n      return res.json({ mensagem: 'Exclu√≠do com sucesso.' });\n    } catch (err) {\n      return res.status(500).json({ erro: err.message });\n    }\n  }\n};\n"
}