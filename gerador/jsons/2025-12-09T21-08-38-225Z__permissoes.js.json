{
  "caminho": "../backend/public/modules/permissoes",
  "arquivo": "permissoes.js",
  "conteudo": "document.addEventListener('DOMContentLoaded', () => {\n  const tbody = document.getElementById('permissoes-tbody');\n  const form = document.getElementById('form-permissao');\n  const formTitulo = document.getElementById('form-titulo');\n  const inputId = document.getElementById('permissao-id');\n  const inputDescricao = document.getElementById('descricao');\n  const inputModulo = document.getElementById('modulo');\n  const inputAcao = document.getElementById('acao');\n  const btnCancelar = document.getElementById('btn-cancelar');\n\n  async function carregarPermissoes() {\n    try {\n      const resposta = await axios.get('/permissoes/listar');\n      const dados = resposta.data || [];\n      tbody.innerHTML = '';\n\n      dados.forEach((item) => {\n        const tr = document.createElement('tr');\n        tr.dataset.id = item.id;\n        tr.dataset.statusId = item.statusId;\n        tr.dataset.ativo = item.ativo;\n\n        const tdId = document.createElement('td');\n        tdId.textContent = item.id;\n\n        const tdDescricao = document.createElement('td');\n        tdDescricao.textContent = item.descricao;\n\n        const tdModulo = document.createElement('td');\n        tdModulo.textContent = item.modulo;\n\n        const tdAcao = document.createElement('td');\n        tdAcao.textContent = item.acao;\n\n        const tdChave = document.createElement('td');\n        tdChave.textContent = item.chave;\n\n        const tdStatus = document.createElement('td');\n        tdStatus.textContent = item.statusId != null ? item.statusId : '';\n\n        const tdAtivo = document.createElement('td');\n        const spanAtivo = document.createElement('span');\n        spanAtivo.classList.add('badge-ativo');\n        if (item.ativo) {\n          spanAtivo.classList.add('sim');\n          spanAtivo.textContent = 'Sim';\n        } else {\n          spanAtivo.classList.add('nao');\n          spanAtivo.textContent = 'Não';\n        }\n        tdAtivo.appendChild(spanAtivo);\n\n        const tdAcoes = document.createElement('td');\n        tdAcoes.classList.add('acoes');\n\n        const btnEditar = document.createElement('button');\n        btnEditar.textContent = 'Editar';\n        btnEditar.classList.add('btn-acao', 'btn-editar');\n        btnEditar.addEventListener('click', () => preencherForm(item));\n\n        const btnExcluir = document.createElement('button');\n        btnExcluir.textContent = 'Excluir';\n        btnExcluir.classList.add('btn-acao', 'btn-excluir');\n        btnExcluir.addEventListener('click', () => excluirPermissao(item.id));\n\n        tdAcoes.appendChild(btnEditar);\n        tdAcoes.appendChild(btnExcluir);\n\n        tr.appendChild(tdId);\n        tr.appendChild(tdDescricao);\n        tr.appendChild(tdModulo);\n        tr.appendChild(tdAcao);\n        tr.appendChild(tdChave);\n        tr.appendChild(tdStatus);\n        tr.appendChild(tdAtivo);\n        tr.appendChild(tdAcoes);\n\n        tbody.appendChild(tr);\n      });\n    } catch (erro) {\n      console.error('Erro ao carregar permissões:', erro);\n      alert('Erro ao carregar permissões.');\n    }\n  }\n\n  function limparForm() {\n    inputId.value = '';\n    inputDescricao.value = '';\n    inputModulo.value = '';\n    inputAcao.value = '';\n    formTitulo.textContent = 'Nova permissão';\n  }\n\n  function preencherForm(item) {\n    inputId.value = item.id;\n    inputDescricao.value = item.descricao;\n    inputModulo.value = item.modulo;\n    inputAcao.value = item.acao;\n    formTitulo.textContent = 'Editar permissão';\n  }\n\n  async function salvarPermissao(evento) {\n    evento.preventDefault();\n    const id = inputId.value;\n    const payloadBase = {\n      descricao: inputDescricao.value.trim(),\n      modulo: inputModulo.value.trim(),\n      acao: inputAcao.value.trim()\n    };\n\n    if (!payloadBase.descricao || !payloadBase.modulo || !payloadBase.acao) {\n      alert('Preencha todos os campos.');\n      return;\n    }\n\n    try {\n      if (!id) {\n        await axios.post('/permissoes/criar', payloadBase);\n      } else {\n        const linha = [...tbody.querySelectorAll('tr')].find(tr => String(tr.dataset.id) === String(id));\n        const statusId = linha ? Number(linha.dataset.statusId) || 1 : 1;\n        const ativo = linha ? (linha.dataset.ativo === 'true' || linha.dataset.ativo === '1') : true;\n\n        await axios.put(`/permissoes/atualizar/${id}`, {\n          ...payloadBase,\n          statusId,\n          ativo\n        });\n      }\n\n      limparForm();\n      await carregarPermissoes();\n    } catch (erro) {\n      console.error('Erro ao salvar permissão:', erro);\n      const msg = erro.response && erro.response.data && erro.response.data.erro\n        ? erro.response.data.erro\n        : 'Erro ao salvar permissão.';\n      alert(msg);\n    }\n  }\n\n  async function excluirPermissao(id) {\n    if (!confirm('Confirma excluir esta permissão?')) {\n      return;\n    }\n\n    try {\n      await axios.delete(`/permissoes/excluir/${id}`);\n      await carregarPermissoes();\n    } catch (erro) {\n      console.error('Erro ao excluir permissão:', erro);\n      const msg = erro.response && erro.response.data && erro.response.data.erro\n        ? erro.response.data.erro\n        : 'Erro ao excluir permissão.';\n      alert(msg);\n    }\n  }\n\n  form.addEventListener('submit', salvarPermissao);\n  btnCancelar.addEventListener('click', limparForm);\n  carregarPermissoes();\n});\n"
}