[
  {
    "caminho": "../backend/public/modules/permissoes",
    "arquivo": "permissoes.js",
    "conteudo": "document.addEventListener('DOMContentLoaded', () => {\n  console.log('[PERMISSOES] DOM carregado');\n\n  const api = window.apiFetch;\n  if (typeof api !== 'function') {\n    console.error('[PERMISSOES] apiFetch não disponível em window');\n  }\n\n  const tbody = document.getElementById('permissoes-tbody');\n  const form = document.getElementById('form-permissao');\n  const formTitulo = document.getElementById('form-titulo');\n  const inputId = document.getElementById('permissao-id');\n  const inputNome = document.getElementById('nome');\n  const inputChave = document.getElementById('chave');\n  const inputDescricao = document.getElementById('descricao');\n  const btnCancelar = document.getElementById('btn-cancelar');\n\n  async function carregarPermissoes() {\n    console.log('[PERMISSOES] GET /api/permissoes/listar');\n    try {\n      const dados = await api('/api/permissoes/listar');\n      console.log('[PERMISSOES] Dados recebidos:', dados);\n\n      tbody.innerHTML = '';\n      dados.forEach((item) => {\n        const tr = document.createElement('tr');\n        tr.dataset.id = item.id;\n        tr.dataset.statusId = item.statusId;\n        tr.dataset.ativo = item.ativo;\n\n        tr.innerHTML = `\n          <td>${item.id}</td>\n          <td>${item.nome}</td>\n          <td>${item.chave}</td>\n          <td>${item.descricao || ''}</td>\n          <td>${item.statusId || ''}</td>\n          <td><span class=\"badge-ativo ${item.ativo ? 'sim' : 'nao'}\">${item.ativo ? 'Sim' : 'Não'}</span></td>\n          <td class=\"acoes\">\n            <button class=\"btn-acao btn-editar\">Editar</button>\n            <button class=\"btn-acao btn-excluir\">Excluir</button>\n          </td>\n        `;\n\n        tr.querySelector('.btn-editar').addEventListener('click', () => preencherForm(item));\n        tr.querySelector('.btn-excluir').addEventListener('click', () => excluirPermissao(item.id));\n\n        tbody.appendChild(tr);\n      });\n    } catch (erro) {\n      console.error('[PERMISSOES] ERRO carregarPermissoes:', erro);\n      alert('Erro ao carregar permissões.');\n    }\n  }\n\n  function limparForm() {\n    inputId.value = '';\n    inputNome.value = '';\n    inputChave.value = '';\n    inputDescricao.value = '';\n    formTitulo.textContent = 'Nova permissão';\n  }\n\n  function preencherForm(item) {\n    inputId.value = item.id;\n    inputNome.value = item.nome;\n    inputChave.value = item.chave;\n    inputDescricao.value = item.descricao || '';\n    formTitulo.textContent = 'Editar permissão';\n  }\n\n  async function salvarPermissao(e) {\n    e.preventDefault();\n\n    const id = inputId.value;\n    const nome = inputNome.value.trim();\n    const chave = inputChave.value.trim();\n    const descricao = inputDescricao.value.trim();\n\n    if (!nome || !chave) {\n      alert('Nome e chave são obrigatórios.');\n      return;\n    }\n\n    try {\n      if (!id) {\n        await api('/api/permissoes/criar', {\n          method: 'POST',\n          body: JSON.stringify({ nome, chave, descricao, statusId: '00000000-0000-0000-0000-000000000001' })\n        });\n      } else {\n        await api(`/api/permissoes/atualizar/${id}`, {\n          method: 'PUT',\n          body: JSON.stringify({ nome, chave, descricao })\n        });\n      }\n\n      limparForm();\n      carregarPermissoes();\n    } catch (erro) {\n      console.error('[PERMISSOES] ERRO salvarPermissao:', erro);\n      alert('Erro ao salvar permissão.');\n    }\n  }\n\n  async function excluirPermissao(id) {\n    if (!confirm('Confirma excluir esta permissão?')) return;\n\n    try {\n      await api(`/api/permissoes/excluir/${id}`, { method: 'DELETE' });\n      carregarPermissoes();\n    } catch (erro) {\n      console.error('[PERMISSOES] ERRO excluirPermissao:', erro);\n      alert('Erro ao excluir permissão.');\n    }\n  }\n\n  form.addEventListener('submit', salvarPermissao);\n  btnCancelar.addEventListener('click', limparForm);\n\n  carregarPermissoes();\n});"
  }
]
