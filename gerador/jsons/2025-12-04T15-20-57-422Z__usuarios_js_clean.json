[
  {
    "caminho": "../backend/public/modules/usuarios",
    "arquivo": "usuarios.js",
    "conteudo": "const API_BASE = \"/api/usuarios\";\\n\\nfunction setMessage(elementId, message, type = \"info\") {\\n  const el = document.getElementById(elementId);\\n  if (!el) return;\\n  el.textContent = message || \"\";\\n  el.className = \"auth-message \" + (message ? `is-${type}` : \"\");\\n}\\n\\nasync function postJSON(url, payload) {\\n  const response = await fetch(url, {\\n    method: \"POST\",\\n    headers: { \"Content-Type\": \"application/json\" },\\n    body: JSON.stringify(payload || {})\\n  });\\n  const data = await response.json().catch(() => ({}));\\n  return { ok: response.ok, status: response.status, data };\\n}\\n\\nasync function handleCadastro(event) {\\n  event.preventDefault();\\n  const form = event.target;\\n  const usuario = form.usuario?.value?.trim();\\n  const email = form.email?.value?.trim();\\n  const senha = form.senha?.value || \"\";\\n  const confirmaSenha = form.confirmaSenha?.value || \"\";\\n  if (!usuario || !email || !senha || !confirmaSenha) {\\n    setMessage(\"msgCadastro\", \"Preencha todos os campos.\", \"error\");\\n    return;\\n  }\\n  if (senha !== confirmaSenha) {\\n    setMessage(\"msgCadastro\", \"As senhas não conferem.\", \"error\");\\n    return;\\n  }\\n  setMessage(\"msgCadastro\", \"Enviando dados...\", \"info\");\\n  try {\\n    const { ok, data, status } = await postJSON(`${API_BASE}/cadastrar`, {\\n      usuario,\\n      email,\\n      senha\\n    });\\n    if (!ok) {\\n      setMessage(\"msgCadastro\", data.erro || `Erro ao cadastrar (HTTP ${status}).`, \"error\");\\n      return;\\n    }\\n    setMessage(\"msgCadastro\", data.mensagem || \"Usuário criado! Verifique o e-mail para confirmar o acesso.\", \"success\");\\n    if (data.email && data.codigo) {\\n      try {\\n        localStorage.setItem(\"ultimoEmailConfirmacao\", data.email);\\n        localStorage.setItem(\"ultimoCodigoConfirmacao\", data.codigo);\\n      } catch (e) {}\\n    }\\n    form.reset();\\n  } catch (error) {\\n    setMessage(\"msgCadastro\", \"Erro interno ao cadastrar usuário.\", \"error\");\\n  }\\n}\\n\\nasync function handleLogin(event) {\\n  event.preventDefault();\\n  const form = event.target;\\n  const email = form.email?.value?.trim();\\n  const senha = form.senha?.value || \"\";\\n  if (!email || !senha) {\\n    setMessage(\"msgLogin\", \"Informe e-mail e senha.\", \"error\");\\n    return;\\n  }\\n  setMessage(\"msgLogin\", \"Autenticando...\", \"info\");\\n  try {\\n    const { ok, data, status } = await postJSON(`${API_BASE}/login`, {\\n      email,\\n      senha\\n    });\\n    if (!ok) {\\n      setMessage(\"msgLogin\", data.erro || `Falha no login (HTTP ${status}).`, \"error\");\\n      return;\\n    }\\n    if (!data.sucesso) {\\n      setMessage(\"msgLogin\", data.erro || \"Não foi possível autenticar.\", \"error\");\\n      return;\\n    }\\n    if (!data.emailVerificado) {\\n      setMessage(\"msgLogin\", \"E-mail não confirmado. Verifique sua caixa de entrada.\", \"warning\");\\n      return;\\n    }\\n    try {\\n      sessionStorage.setItem(\"usuarioAtual\", email.trim().toLowerCase());\\n    } catch (e) {}\\n    setMessage(\"msgLogin\", \"Login efetuado com sucesso! Redirecionando...\", \"success\");\\n    window.location.href = \"/painel\";\\n  } catch (error) {\\n    setMessage(\"msgLogin\", \"Erro interno ao autenticar.\", \"error\");\\n  }\\n}\\n\\nasync function handleConfirmacaoCodigo(event) {\\n  event.preventDefault();\\n  const form = event.target;\\n  const email = form.email?.value?.trim();\\n  const codigo = form.codigo?.value?.trim();\\n  if (!email || !codigo) {\\n    setMessage(\"msgConfirmacao\", \"Informe e-mail e código.\", \"error\");\\n    return;\\n  }\\n  setMessage(\"msgConfirmacao\", \"Validando código...\", \"info\");\\n  try {\\n    const { ok, data, status } = await postJSON(`${API_BASE}/confirmar-codigo`, {\\n      email,\\n      codigo\\n    });\\n    if (!ok || !data.sucesso) {\\n      setMessage(\"msgConfirmacao\", data.erro || `Erro ao confirmar código (HTTP ${status}).`, \"error\");\\n      return;\\n    }\\n    setMessage(\"msgConfirmacao\", \"E-mail confirmado com sucesso!\", \"success\");\\n  } catch (error) {\\n    setMessage(\"msgConfirmacao\", \"Erro interno ao confirmar código.\", \"error\");\\n  }\\n}\\n\\nasync function handleReenvio() {\\n  const email = document.getElementById(\"confEmail\")?.value?.trim();\\n  if (!email) {\\n    setMessage(\"msgConfirmacao\", \"Informe o e-mail para reenviar o código.\", \"error\");\\n    return;\\n  }\\n  setMessage(\"msgConfirmacao\", \"Reenviando código...\", \"info\");\\n  try {\\n    const { ok, data, status } = await postJSON(`${API_BASE}/reenviar-confirmacao`, { email });\\n    if (!ok || !data.sucesso) {\\n      setMessage(\"msgConfirmacao\", data.erro || `Erro ao reenviar código (HTTP ${status}).`, \"error\");\\n      return;\\n    }\\n    setMessage(\"msgConfirmacao\", \"Código reenviado com sucesso! Verifique seu e-mail.\", \"success\");\\n  } catch (error) {\\n    setMessage(\"msgConfirmacao\", \"Erro interno ao reenviar código.\", \"error\");\\n  }\\n}\\n\\nwindow.addEventListener(\"DOMContentLoaded\", () => {\\n  const formCadastro = document.getElementById(\"formCadastro\");\\n  if (formCadastro) formCadastro.addEventListener(\"submit\", handleCadastro);\\n\\n  const formLogin = document.getElementById(\"formLogin\");\\n  if (formLogin) formLogin.addEventListener(\"submit\", handleLogin);\\n\\n  const formConfirmar = document.getElementById(\"formConfirmarCodigo\");\\n  if (formConfirmar) formConfirmar.addEventListener(\"submit\", handleConfirmacaoCodigo);\\n\\n  const btnReenviar = document.getElementById(\"btnReenviar\");\\n  if (btnReenviar) btnReenviar.addEventListener(\"click\", handleReenvio);\\n\\n  const btnAbrirConfirmacao = document.getElementById(\"btnAbrirConfirmacao\");\\n  const secConfirmacao = document.getElementById(\"secConfirmacao\");\\n  if (btnAbrirConfirmacao && secConfirmacao) {\\n    btnAbrirConfirmacao.addEventListener(\"click\", () => {\\n      secConfirmacao.hidden = false;\\n    });\\n  }\\n});\\n"
  }
]