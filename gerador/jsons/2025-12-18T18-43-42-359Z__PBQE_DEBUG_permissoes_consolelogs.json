[
  {
    "caminho": "../backend/public/modules/permissoes",
    "arquivo": "permissoes.js",
    "conteudo": "document.addEventListener('DOMContentLoaded', () => {\n  console.log('[PERMISSOES] DOM carregado');\n\n  const tbody = document.getElementById('permissoes-tbody');\n  const form = document.getElementById('form-permissao');\n  const formTitulo = document.getElementById('form-titulo');\n  const inputId = document.getElementById('permissao-id');\n  const inputNome = document.getElementById('nome');\n  const inputChave = document.getElementById('chave');\n  const inputDescricao = document.getElementById('descricao');\n  const btnCancelar = document.getElementById('btn-cancelar');\n\n  console.log('[PERMISSOES] Elementos capturados:', { tbody, form, formTitulo });\n\n  async function carregarPermissoes() {\n    console.log('[PERMISSOES] carregarPermissoes() chamado');\n    try {\n      console.log('[PERMISSOES] GET /api/permissoes/listar');\n      const resposta = await axios.get('/api/permissoes/listar');\n      console.log('[PERMISSOES] Resposta recebida:', resposta);\n\n      const dados = resposta.data || [];\n      console.log('[PERMISSOES] Dados:', dados);\n\n      tbody.innerHTML = '';\n\n      dados.forEach((item) => {\n        console.log('[PERMISSOES] Renderizando item:', item);\n\n        const tr = document.createElement('tr');\n        tr.dataset.id = item.id;\n        tr.dataset.statusId = item.statusId;\n        tr.dataset.ativo = item.ativo;\n\n        tr.innerHTML = `\n          <td>${item.id}</td>\n          <td>${item.nome}</td>\n          <td>${item.chave}</td>\n          <td>${item.descricao || ''}</td>\n          <td>${item.statusId || ''}</td>\n          <td><span class=\"badge-ativo ${item.ativo ? 'sim' : 'nao'}\">${item.ativo ? 'Sim' : 'Não'}</span></td>\n          <td class=\"acoes\">\n            <button class=\"btn-acao btn-editar\">Editar</button>\n            <button class=\"btn-acao btn-excluir\">Excluir</button>\n          </td>\n        `;\n\n        tr.querySelector('.btn-editar').addEventListener('click', () => preencherForm(item));\n        tr.querySelector('.btn-excluir').addEventListener('click', () => excluirPermissao(item.id));\n\n        tbody.appendChild(tr);\n      });\n    } catch (erro) {\n      console.error('[PERMISSOES] ERRO carregarPermissoes:', erro);\n      console.error('[PERMISSOES] Status:', erro?.response?.status);\n      console.error('[PERMISSOES] Data:', erro?.response?.data);\n      alert('Erro ao carregar permissões.');\n    }\n  }\n\n  function limparForm() {\n    console.log('[PERMISSOES] limparForm()');\n    inputId.value = '';\n    inputNome.value = '';\n    inputChave.value = '';\n    inputDescricao.value = '';\n    formTitulo.textContent = 'Nova permissão';\n  }\n\n  function preencherForm(item) {\n    console.log('[PERMISSOES] preencherForm()', item);\n    inputId.value = item.id;\n    inputNome.value = item.nome;\n    inputChave.value = item.chave;\n    inputDescricao.value = item.descricao || '';\n    formTitulo.textContent = 'Editar permissão';\n  }\n\n  async function salvarPermissao(e) {\n    e.preventDefault();\n    console.log('[PERMISSOES] salvarPermissao()');\n\n    const id = inputId.value;\n    const nome = inputNome.value.trim();\n    const chave = inputChave.value.trim();\n    const descricao = inputDescricao.value.trim();\n\n    console.log('[PERMISSOES] Payload:', { id, nome, chave, descricao });\n\n    if (!nome || !chave) {\n      alert('Nome e chave são obrigatórios.');\n      return;\n    }\n\n    try {\n      if (!id) {\n        console.log('[PERMISSOES] POST /api/permissoes/criar');\n        await axios.post('/api/permissoes/criar', { nome, chave, descricao, statusId: '00000000-0000-0000-0000-000000000001' });\n      } else {\n        console.log('[PERMISSOES] PUT /api/permissoes/atualizar/' + id);\n        await axios.put(`/api/permissoes/atualizar/${id}`, { nome, chave, descricao });\n      }\n\n      limparForm();\n      carregarPermissoes();\n    } catch (erro) {\n      console.error('[PERMISSOES] ERRO salvarPermissao:', erro);\n      console.error('[PERMISSOES] Status:', erro?.response?.status);\n      console.error('[PERMISSOES] Data:', erro?.response?.data);\n      alert(erro.response?.data?.erro || 'Erro ao salvar permissão.');\n    }\n  }\n\n  async function excluirPermissao(id) {\n    console.log('[PERMISSOES] excluirPermissao()', id);\n\n    if (!confirm('Confirma excluir esta permissão?')) return;\n\n    try {\n      console.log('[PERMISSOES] DELETE /api/permissoes/excluir/' + id);\n      await axios.delete(`/api/permissoes/excluir/${id}`);\n      carregarPermissoes();\n    } catch (erro) {\n      console.error('[PERMISSOES] ERRO excluirPermissao:', erro);\n      console.error('[PERMISSOES] Status:', erro?.response?.status);\n      console.error('[PERMISSOES] Data:', erro?.response?.data);\n      alert(erro.response?.data?.erro || 'Erro ao excluir permissão.');\n    }\n  }\n\n  form.addEventListener('submit', salvarPermissao);\n  btnCancelar.addEventListener('click', limparForm);\n\n  carregarPermissoes();\n});"
  }
]
